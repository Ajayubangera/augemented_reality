<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>3D Viewer - Full Manual Rotation</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body style="margin:0; overflow:hidden;">

  <a-scene background="color: #ECECEC">

    <!-- Lighting -->
    <a-entity light="type: ambient; intensity: 1"></a-entity>
    <a-entity light="type: directional; intensity: 1" position="1 1 0.5"></a-entity>

    <!-- 3D Model -->
    <a-entity id="model" gltf-model="url(monument.glb)"
              scale="1 1 1"
              position="0 0 0"
              rotation="0 0 0"
              animation="property: rotation; to: 0 360 0; loop: true; dur: 30000; easing: linear">
    </a-entity>

    <!-- Camera -->
    <a-entity id="camera" camera look-controls position="0 1.5 4"></a-entity>

  </a-scene>

  <script>
    const model = document.getElementById('model');

    // Stop auto-rotation when user interacts with the mouse
    let isDragging = false;
    let previousX = 0;
    let previousY = 0;

    window.addEventListener('mousedown', (e) => {
      isDragging = true;
      previousX = e.clientX;
      previousY = e.clientY;
      model.removeAttribute('animation'); // stop auto-rotation
    });

    window.addEventListener('mouseup', () => {
      isDragging = false;
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;

      const deltaX = e.clientX - previousX;
      const deltaY = e.clientY - previousY;
      previousX = e.clientX;
      previousY = e.clientY;

      let rotation = model.getAttribute('rotation');
      rotation.y += deltaX * 0.5; // horizontal rotation (around Y-axis)
      rotation.x -= deltaY * 0.5; // vertical rotation (around X-axis)
      rotation.x = Math.min(Math.max(rotation.x, -90), 90); // limit vertical rotation
      model.setAttribute('rotation', rotation);
    });

    // Load model dynamically from query string if provided
    const params = new URLSearchParams(window.location.search);
    const modelUrl = params.get('model');
    if (modelUrl) {
      model.setAttribute('gltf-model', `url(${modelUrl})`);
    }
  </script>

</body>
</html>
